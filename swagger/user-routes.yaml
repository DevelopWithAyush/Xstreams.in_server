openapi: 3.0.0
info:
  title: Authentication API
  description: User authentication and authorization endpoints
  version: 1.0.0

paths:
  /api/v1/auth/google:
    get:
      tags:
        - Authentication
      summary: Initiate Google OAuth authentication
      description: Redirects user to Google OAuth consent screen for authentication
      responses:
        "302":
          description: Redirect to Google OAuth consent screen
          headers:
            Location:
              description: Google OAuth URL
              schema:
                type: string
                example: "https://accounts.google.com/oauth/authorize?..."
        "500":
          description: Internal server error
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: "Failed to initiate Google OAuth"

  /api/v1/auth/callback:
    get:
      tags:
        - Authentication
      summary: Handle Google OAuth callback
      description: Processes the OAuth callback from Google and creates user session
      parameters:
        - name: code
          in: query
          required: true
          description: Authorization code from Google OAuth
          schema:
            type: string
        - name: state
          in: query
          required: false
          description: State parameter for CSRF protection
          schema:
            type: string
      responses:
        "302":
          description: Redirect to frontend with user data and token
          headers:
            Location:
              description: Frontend URL with user data and token as query parameters
              schema:
                type: string
                example: "http://localhost:3000/audit?user=%7B%22id%22%3A%22123%22%7D&token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        "400":
          description: Bad request - missing or invalid parameters
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: "Authorization code is required"
        "401":
          description: Unauthorized - OAuth authentication failed
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: "Google OAuth authentication failed"
        "500":
          description: Internal server error
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: "Failed to process OAuth callback"

  /api/v1/auth/logout:
    get:
      tags:
        - Authentication
      summary: Logout user
      description: Invalidates user session and token
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Successfully logged out
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Successfully logged out"
        "401":
          description: Unauthorized - invalid or missing token
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: "Unauthorized access"
        "500":
          description: Internal server error
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: "Failed to logout"

  /api/v1/auth/me:
    get:
      tags:
        - Authentication
      summary: Get current user details
      description: Retrieves the authenticated user's profile information
      security:
        - bearerAuth: []
      responses:
        "200":
          description: User details retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      id:
                        type: string
                        example: "user_123456789"
                      name:
                        type: string
                        example: "John Doe"
                      email:
                        type: string
                        format: email
                        example: "john.doe@example.com"
                      picture:
                        type: string
                        format: uri
                        example: "https://lh3.googleusercontent.com/a/default-user=s96-c"
                      provider:
                        type: string
                        example: "google"
                      createdAt:
                        type: string
                        format: date-time
                        example: "2024-01-15T10:30:00.000Z"
                      updatedAt:
                        type: string
                        format: date-time
                        example: "2024-01-15T10:30:00.000Z"
        "401":
          description: Unauthorized - invalid or missing token
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: "Unauthorized access"
        "404":
          description: User not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: "User not found"
        "500":
          description: Internal server error
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: "Failed to retrieve user details"

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT token obtained from successful OAuth authentication

  schemas:
    User:
      type: object
      properties:
        id:
          type: string
          description: Unique user identifier
        name:
          type: string
          description: User's full name
        email:
          type: string
          format: email
          description: User's email address
        picture:
          type: string
          format: uri
          description: URL to user's profile picture
        provider:
          type: string
          description: OAuth provider (google)
        createdAt:
          type: string
          format: date-time
          description: Account creation timestamp
        updatedAt:
          type: string
          format: date-time
          description: Last update timestamp

    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        message:
          type: string
          description: Error message describing what went wrong

    SuccessResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          description: Success message
        data:
          type: object
          description: Response data (optional)

tags:
  - name: Authentication
    description: User authentication and authorization endpoints
